<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <style>
    
body {
  margin: 0;
  font-family: "Montserrat", sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
  background: #131418;
}

.video-container {
  width: 100%;
  height:  100%;
  position: relative;
  color: #fff;
  overflow: hidden;
  background: rgb(25, 25, 25);
  display: flex;
  align-items: center;
  justify-content: center;
}

.back-button {
  position: fixed;
  margin-bottom: 96%;
  left: 10px;
  z-index: 9999;
  cursor: pointer;
  color: #fff;
  font-size: 40px;
}

.back-button:hover {
  color: #ff6a00;
}

.video-container.fullscreen .back-button {
  position: fixed;
  margin-bottom: 100%;
  left: 10px;
}

.video-container video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.custom-loader {
  position: absolute;
  width: 50px;
  height: 10px;
  border-radius: 50%;
  border-top: 5px solid transparent;
  border-right: 5px solid #ffffff;
  border-left: 5px solid #ffffff;
  border-bottom: 5px solid #ffffff;
  border-radius: 4%;
  z-index: 9999;
  animation: rotation 2s infinite ease;
  -webkit-animation: rotation 2s infinite ease;
  display: none;
}

.player-state {
  display: flex;
  position: absolute;
  width: 100%;
  justify-content: space-around;
}

.state-btn {
  font-size: 2.3rem;
  width: 80px;
  height: 80px;
  cursor: pointer;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  background: rgba(36, 36, 36, 0.667);
  z-index: 9999;
  -webkit-tap-highlight-color: transparent;
  opacity: 0;
  user-select: none;
  transform: scale(0);
}

.state-forward,
.state-backward {
  font-size: 1.5rem;
}

.state-forward .forward-duration {
  margin-right: 0.5rem;
}

.state-backward .backward-duration {
  margin-left: 0.5rem;
}

.animate-state {
  animation: playPause 0.5s forwards;
}

.show-state {
  transform: scale(1);
  opacity: 1;
}

.show-controls {
  opacity: 1 !important;
  transform: translateY(0) !important;
  visibility: visible !important;
}

.controls {
  position: absolute;
  bottom: 0;
  left: 0;
  padding: 5rem 1rem 0.5rem 1rem;
  width: 100%;
  background: linear-gradient(to top, #000000b8 -100%, transparent);
  box-sizing: border-box;
  opacity: 0;
  transform: translateY(40px);
  visibility: hidden;
  z-index: 99;
  transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.duration {
  position: relative;
  width: 100%;
  height: 8px;
  background: #46464674;
  cursor: pointer;
  transition: all 0.2s;
  border-radius: 5px;
}

.duration:hover {
  height: 10px;
}

.duration .buffer {
  height: 100%;
  position: absolute;
  inset: 0;
  background-color: #ff6a0045;
  z-index: 9;
  width: 0;
  
}

.hover-time {
  height: 100%;
  position: absolute;
  inset: 0;
  background: #ffffff9a;
  z-index: 99;
  display: flex;
  align-items: center;
  width: 0;
}

.hover-time .hover-duration {
  position: absolute;
  right: calc((-25px / 2));
  top: -25px;
  background: #3c3c3ca7;
  padding: 0.2rem;
  border-radius: 2px;
  font-size: 0.7rem;
  visibility: hidden;
  font-weight: bold;
  opacity: 0;
  transform: scale(0);
}

.duration:hover .hover-time .hover-duration {
  visibility: visible;
  font-size: 1rem;
  background-color: black;
  margin-bottom: 3px;
  opacity: 1;
  transition: all 0.2s;
  transform: scale(1);
  border-radius: 5px
  

}

.duration .current-time {
  height: 100%;
  position: absolute;
  inset: 0;
  background: #ff6a00;
  z-index: 999;
  display: flex;
  align-items: center;
  width: 0;
  border-radius: 5px;
}

.current-time::before {
  content: "";
  position: absolute;
  right: calc((-25px / 2));
  background: #ffffff;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  transition: all 0.2s;
  visibility: hidden;
  transform: scale(0);
}

.duration:hover .current-time::before {
  visibility: visible;
  transform: scale(1);
  
}

.btn-controls {
  padding-top: 1rem;
  font-size: 1.2rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.btn-con {
  display: flex;
  align-items: center;
}

.btn-con,
.btn-controls > span {
  cursor: pointer;
}

.play-pause {
  display: flex;
  margin-right: 0.5rem;
}

.control-btn {
  width: 2.2rem;
  height: 2.2rem;
  border-radius: 50%;
  background: #00000072;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid transparent;
  box-sizing: border-box;
  position: relative;
  margin-right: 0.5rem;
}

.control-btn:last-child {
  margin-right: 0;
}

.control-btn:hover {
  border: 1px solid #3131315c;
}

.control-btn::before {
  content: "";
  display: block;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: #2424246a;
  position: absolute;
  transition: all 0.1s;
  transform: scale(0);
}

.control-btn:active::before {
  transform: scale(1);
  border: 1px solid #3131315c;
}

.time-container {
  font-size: 13px;
  font-weight: 500;
  padding-left: 0.7rem;
}

.volume {
  display: flex;
  align-items: center;
  cursor: default;
}

.mute-unmute {
  display: flex;
  cursor: pointer;
}

.max-vol {
  height: 5px;
  cursor: pointer;
  background: #ffffff6e;
  transition: all 0.1s;
  width: 100px;
  visibility: hidden;
  transform: scaleX(0);
  transform-origin: left;
  display: flex;
  align-items: center;
}

.max-vol.show {
  width: 150px;
  visibility: visible;
  transform: scaleX(1);
}

.current-vol {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 160%;
  background: #ff6a00;
  display: flex;
  transition: none;
  align-items: center;
}

.current-vol::before {
  content: "";
  position: absolute;
  right: -5px;
  width: 18px;
  height: 18px;
  display: block;
  border-radius: 50%;
  background: #eee;
}

.setting-menu {
  opacity: 0;
  visibility: hidden;
  list-style: none;
  padding-inline-start: 0;
  margin-block-start: 0;
  margin-block-end: 0;
  position: absolute;
  bottom: 4.5rem;
  transition: all 0.2s;
  background: rgba(28, 28, 28, 0.9);
  transform: scaleY(0);
  transform-origin: bottom;
  border-radius: 5px;
}

.setting-menu li {
  padding: 0.3rem 2rem;
  margin: 0.5rem;
  transition: all 0.2s;
  border-radius: 5px;
  font-size: 0.9rem;
  font-weight: 500;
}

.speed-active {
  background: rgb(225, 136, 85);
}

.setting-menu li:hover {
  background: #b27051;
}

.setting-btn {
  display: flex;
}

.show-setting-menu {
  opacity: 1;
  transform: scaleY(1);
  visibility: visible;
}

.theater {
  width: 100% !important;
}

.theater-btn .theater-default,
.theater-btn .theater-active {
  display: flex;
}

.video-container.theater .theater-default {
  display: none;
}

.video-container:not(.theater) .theater-active {
  display: none;
}

.fullscreen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 9999;
}

.video-container.fullscreen video {
  width: 100% !important;
  height: 100% !important;
}

.right-controls {
  display: flex;
  align-items: center;
}

.middle-controls {
  display: flex;
  align-items: center;
  margin-left: 3%;
}


.right-controls span {
  cursor: pointer;
}

.full,
.contract {
  display: none;
}

.video-container:not(.fullscreen) .full {
  display: flex;
}

.video-container.fullscreen .contract {
  display: flex;
}

@keyframes playPause {
  50% {
    opacity: 1;
    transform: scale(1.1);
  }
  100% {
    opacity: 0;
    transform: scale(1);
  }
}

@keyframes rotation {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.audio {
  position: relative;
  padding: 10px;
}

.dropdown-content {
  display: none;
  position: absolute;
  bottom: 30px; /* Updated position to be above the button */
  right: 0;
  margin-bottom: 40px;
  cursor: pointer;
  padding: 8px 12px;
  background-color: rgba(28, 28, 28, 0.9);
  border-radius: 5px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.dropdown-content.show {
  display: block;
}

.dropdown-option {
  cursor: pointer;
  padding: 8px;
}

.dropdown-option:hover {
  background-color: #b27051;
}

.dropdown-content:hover .dropdown-languages {
  display: block;
}

.dropdown-languages {
  display: none;
}

.dropdown-languages:hover {
  display: block;
}

/* Increase the font size of current time and total time */
.current-duration,
.total-duration {
  font-size: 20px; /* Change this value to your desired font size */
}


   </style>
    <script
      type="module"
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <title>REALM PLAYER</title>
  </head>
  <body>
    <div class="video-container"> 
      <video
        id="video"
      autoplay
      ></video>
      <span class="custom-loader"></span>
      <div class="player-state">
        <span class="state-btn state-backward">
          <ion-icon name="play-back-outline"></ion-icon>
          <span class="backward-duration">5</span>
        </span>
        <span class="main-state state-btn">
          <ion-icon name="play-outline"></ion-icon>
        </span>
        <span class="state-btn state-forward">
          <span class="forward-duration">5</span>
          <ion-icon name="play-forward-outline"></ion-icon>
        </span>
      </div>
      <div class="controls">
        <div class="duration">
          <div class="current-time"></div>
          <div class="hover-time">
            <span class="hover-duration"></span>
          </div>
          <div class="buffer"></div>
        </div>
        <div class="btn-controls">
          <div class="btn-con">
            <!-- <span class="play-pause control-btn">
              <ion-icon name="play-outline"></ion-icon>
            </span> --> 
            <span class="volume">
              <span class="mute-unmute control-btn">
                <ion-icon name="volume-high-outline"></ion-icon>
              </span>
              <div class="max-vol">
                <div class="current-vol"></div>
              </div>
            </span>
            <span class="time-container">
              <span class="current-duration">0:00</span>
              <span>/</span>
              <span class="total-duration">0:00</span>
            </span>
          </div>
          <div class="middle-controls">
            <span class="backward control-btn" title="5 backward">
              <ion-icon name="play-back-outline"></ion-icon>
            </span>
            <span class="play-pause control-btn">
              <ion-icon name="play-outline"></ion-icon>
            </span>
            <span class="forward control-btn" title="5 forward">
              <ion-icon name="play-forward-outline"></ion-icon>
            </span>
          </div>
          <div class="right-controls">
            <!-- <span class="backward control-btn" title="5 backward">
              <ion-icon name="play-back-outline"></ion-icon>
            </span>
            <span class="forward control-btn" title="5 forward">
              <ion-icon name="play-forward-outline"></ion-icon>
            </span> -->
            <span class="mini-player control-btn">
              <ion-icon name="albums-outline"></ion-icon>
            </span>
            <span class="audio control-btn">
              <ion-icon name="musical-notes-outline"></ion-icon>
              <div class="dropdown-content">
                <div class="dropdown-box">
                  <span class="dropdown-heading" style="color: #ff6a00;"><b>Audio</b></span>
                  <ul class="dropdown-options">
                    <li class="dropdown-option" data-option="audio" data-value="english">
                      Telugu
                    </li>
                    <li class="dropdown-option" data-option="audio" data-value="spanish">
                       Hindi
                    </li>
                    <li class="dropdown-option" data-option="audio" data-value="french">
                      English
                    </li>
                  </ul>
                </div>
                <div class="dropdown-box">
                  <span class="dropdown-heading" style="color: #ff6a00;"><b>Subtitles</b></span>
                  <ul class="dropdown-options">
                    <li class="dropdown-option" data-option="subtitles" data-value="english">
                      English
                    </li>
                    <li class="dropdown-option" data-option="subtitles" data-value="spanish">
                      Telugu
                    </li>
                    <li class="dropdown-option" data-option="subtitles" data-value="french">
                      Hindi
                    </li>
                  </ul>
                </div>
              </div>
            </span>
            
            <span class="settings control-btn">
              <span class="setting-btn">
                <ion-icon name="options-outline"></ion-icon>
              </span>
              <ul class="setting-menu">
                <li data-value="0.25">0.25x</li>
                <li data-value="0.5">0.5x</li>
                <li data-value="0.75">0.75x</li>
                <li data-value="1" class="speed-active">1x</li>
                <li data-value="1.25">1.25x</li>
                <li data-value="1.5">1.5x</li>
                <li data-value="1.75">1.75x</li>
                <li data-value="2">2x</li>
              </ul>
            </span>
            <span class="theater-btn control-btn">
              <span class="theater-default">
                <ion-icon name="tablet-landscape-outline"></ion-icon>
               </span>  
              <span class="theater-active">
                <ion-icon name="tv-outline"></ion-icon>
              </span>
            </span>
            <span class="fullscreen-btn control-btn" title="fullscreen">
              <span class="full">
                <ion-icon name="scan-outline"></ion-icon>
              </span>
              <span class="contract">
                <ion-icon name="contract-outline"></ion-icon>
              </span>
            </span>
            <a href="{% url 'home' %}" class="back-button">
              <ion-icon name="arrow-back-outline"></ion-icon>
            </a>
            
          </div>
        </div> 
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
      const video = document.querySelector("video");
const fullscreen = document.querySelector(".fullscreen-btn");
const playPause = document.querySelector(".play-pause");
const volume = document.querySelector(".volume");
const currentTime = document.querySelector(".current-time");
const duration = document.querySelector(".duration");
const buffer = document.querySelector(".buffer");
const totalDuration = document.querySelector(".total-duration");
const currentDuration = document.querySelector(".current-duration");
const controls = document.querySelector(".controls");
const videoContainer = document.querySelector(".video-container");
const currentVol = document.querySelector(".current-vol");
const totalVol = document.querySelector(".max-vol");
const mainState = document.querySelector(".main-state");
const muteUnmute = document.querySelector(".mute-unmute");
const forward = document.querySelector(".forward");
const backward = document.querySelector(".backward");
const hoverTime = document.querySelector(".hover-time");
const hoverDuration = document.querySelector(".hover-duration");
const miniPlayer = document.querySelector(".mini-player");
const settingsBtn = document.querySelector(".setting-btn");
const settingMenu = document.querySelector(".setting-menu");
const theaterBtn = document.querySelector(".theater-btn");
const speedButtons = document.querySelectorAll(".setting-menu li");
const backwardSate = document.querySelector(".state-backward");
const forwardSate = document.querySelector(".state-forward");
const loader = document.querySelector(".custom-loader");
const backBtn = document.querySelector(".back-button");
const audioBtn = document.querySelector(".audio");
 const dropdownContent = audioBtn.querySelector(".dropdown-content"); 
const dropdownOptions = document.querySelectorAll(".dropdown-option");

  // HLS setup and load
  
  var videoUrl = "{{ video_url }}";
      console.log(videoUrl);
      if (Hls.isSupported()) {
        var hls = new Hls();
        hls.loadSource(videoUrl);
        hls.attachMedia(video);
      } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
        video.src = videoUrl;
      }




let isPlaying = false,
  mouseDownProgress = false,
  mouseDownVol = false,
  isCursorOnControls = false,
  muted = false,
  timeout,
  volumeVal = 1,
  mouseOverDuration = false,
  touchClientX = 0,
  touchPastDurationWidth = 0,
  touchStartTime = 0;

currentVol.style.width = volumeVal * 100 + "%";

// Video Event Listeners
video.addEventListener("loadedmetadata", canPlayInit);
video.addEventListener("play", play);
video.addEventListener("pause", pause);
video.addEventListener("progress", handleProgress);
video.addEventListener("waiting", handleWaiting);
video.addEventListener("playing", handlePlaying);

document.addEventListener("keydown", handleShorthand);
fullscreen.addEventListener("click", toggleFullscreen);

playPause.addEventListener("click", togglePlay);
      mainState.addEventListener("click", togglePlay);

      function togglePlay() {
        if (video.paused) {
          video.play();
        } else {
          video.pause();
        }
      }

duration.addEventListener("click", navigate);

duration.addEventListener("mousedown", (e) => {
  mouseDownProgress = true;
  navigate(e);
});
  
totalVol.addEventListener("mousedown", (e) => {
  mouseDownVol = true;
  handleVolume(e);
});

document.addEventListener("mouseup", (e) => {
  mouseDownProgress = false;
  mouseDownVol = false;
});

document.addEventListener("mousemove", handleMousemove);

duration.addEventListener("mouseenter", (e) => {
  mouseOverDuration = true;
});
duration.addEventListener("mouseleave", (e) => {
  mouseOverDuration = false;
  hoverTime.style.width = 0;
  hoverDuration.innerHTML = "";
});

videoContainer.addEventListener("click", toggleMainState);
videoContainer.addEventListener("fullscreenchange", () => {
  videoContainer.classList.toggle("fullscreen", document.fullscreenElement);
});
videoContainer.addEventListener("mouseleave", hideControls);
videoContainer.addEventListener("mousemove", (e) => {
  controls.classList.add("show-controls");
  hideControls();
});
videoContainer.addEventListener("touchstart", (e) => {
  controls.classList.add("show-controls");
  touchClientX = e.changedTouches[0].clientX;
  const currentTimeRect = currentTime.getBoundingClientRect();
  touchPastDurationWidth = currentTimeRect.width;
  touchStartTime = e.timeStamp;
});
videoContainer.addEventListener("touchend", () => {
  hideControls();
  touchClientX = 0;
  touchPastDurationWidth = 0;
  touchStartTime = 0;
});
videoContainer.addEventListener("touchmove", handleTouchNavigate);

controls.addEventListener("mouseenter", (e) => {
  controls.classList.add("show-controls");
  isCursorOnControls = true;
});

controls.addEventListener("mouseleave", (e) => {
  isCursorOnControls = false;
});

mainState.addEventListener("click", toggleMainState);

mainState.addEventListener("animationend", handleMainSateAnimationEnd);

muteUnmute.addEventListener("click", toggleMuteUnmute);

muteUnmute.addEventListener("mouseenter", (e) => {
  if (!muted) {
    totalVol.classList.add("show");
  } else {
    totalVol.classList.remove("show");
  }
});

muteUnmute.addEventListener("mouseleave", (e) => {
  if (e.relatedTarget != volume) {
    totalVol.classList.remove("show");
  }
});

forward.addEventListener("click", handleForward);

forwardSate.addEventListener("animationend", () => {
  forwardSate.classList.remove("show-state");
  forwardSate.classList.remove("animate-state");
});

backward.addEventListener("click", handleBackward);

backwardSate.addEventListener("animationend", () => {
  backwardSate.classList.remove("show-state");
  backwardSate.classList.remove("animate-state");
});

miniPlayer.addEventListener("click", toggleMiniPlayer);

theaterBtn.addEventListener("click", toggleTheater);

settingsBtn.addEventListener("click", handleSettingMenu);

speedButtons.forEach((btn) => {
  btn.addEventListener("click", handlePlaybackRate);
});

function canPlayInit() {
  totalDuration.innerHTML = showDuration(video.duration);
  video.volume = volumeVal;
  muted = video.muted;
  if (video.paused) {
    controls.classList.add("show-controls");
    mainState.classList.add("show-state");
    handleMainStateIcon(`<ion-icon name="play-outline"></ion-icon>`);
  }
}

function play() {
  video.play();
  isPlaying = true;
  playPause.innerHTML = `<ion-icon name="pause-outline"></ion-icon>`;
  mainState.classList.remove("show-state");
  handleMainStateIcon(`<ion-icon name="pause-outline"></ion-icon>`);
  // watchProgress();
}

// function watchProgress() {
//   if (isPlaying) {
//     requestAnimationFrame(watchProgress);
//     handleProgressBar();
//   }
// }

video.ontimeupdate = handleProgressBar;

function handleProgressBar() {
  currentTime.style.width = (video.currentTime / video.duration) * 100 + "%";
  currentDuration.innerHTML = showDuration(video.currentTime);
}

function pause() {
  video.pause();
  isPlaying = false;
  playPause.innerHTML = `<ion-icon name="play-outline"></ion-icon>`;
  controls.classList.add("show-controls");
  mainState.classList.add("show-state");
  handleMainStateIcon(`<ion-icon name="play-outline"></ion-icon>`);
  if (video.ended) {
    currentTime.style.width = 100 + "%";
  }
}

function handleWaiting() {
  loader.style.display = "unset";
}

function handlePlaying() {
  loader.style.display = "none";
}

function navigate(e) {
  const totalDurationRect = duration.getBoundingClientRect();
  const width = Math.min(
    Math.max(0, e.clientX - totalDurationRect.x),
    totalDurationRect.width
  );
  currentTime.style.width = (width / totalDurationRect.width) * 100 + "%";
  video.currentTime = (width / totalDurationRect.width) * video.duration;
}

function handleTouchNavigate(e) {
  hideControls();
  if (e.timeStamp - touchStartTime > 500) {
    const durationRect = duration.getBoundingClientRect();
    const clientX = e.changedTouches[0].clientX;
    const value = Math.min(
      Math.max(0, touchPastDurationWidth + (clientX - touchClientX) * 0.2),
      durationRect.width
    );
    currentTime.style.width = value + "px";
    video.currentTime = (value / durationRect.width) * video.duration;
    currentDuration.innerHTML = showDuration(video.currentTime);
  }
}

function showDuration(time) {
  const hours = Math.floor(time / 60 ** 2);
  const min = Math.floor((time / 60) % 60);
  const sec = Math.floor(time % 60);
  if (hours > 0) {
    return `${formatter(hours)}:${formatter(min)}:${formatter(sec)}`;
  } else {
    return `${formatter(min)}:${formatter(sec)}`;
  }
}

function formatter(number) {
  return new Intl.NumberFormat({}, { minimumIntegerDigits: 2 }).format(number);
}

function toggleMuteUnmute() {
  if (!muted) {
    video.volume = 0;
    muted = true;
    muteUnmute.innerHTML = `<ion-icon name="volume-mute-outline"></ion-icon>`;
    handleMainStateIcon(`<ion-icon name="volume-mute-outline"></ion-icon>`);
    totalVol.classList.remove("show");
  } else {
    video.volume = volumeVal;
    muted = false;
    totalVol.classList.add("show");
    handleMainStateIcon(`<ion-icon name="volume-high-outline"></ion-icon>`);
    muteUnmute.innerHTML = `<ion-icon name="volume-high-outline"></ion-icon>`;
  }
}

function hideControls() {
  if (timeout) {
    clearTimeout(timeout);
  }
  timeout = setTimeout(() => {
    if (isPlaying && !isCursorOnControls) {
      controls.classList.remove("show-controls");
      settingMenu.classList.remove("show-setting-menu");
    }
  }, 1000);
}

function toggleMainState(e) {
  e.stopPropagation();
  if (!e.path.includes(controls)) {
    if (!isPlaying) {
      play();
    } else {
      pause();
    }
  }
}

function handleVolume(e) {
  const totalVolRect = totalVol.getBoundingClientRect();
  currentVol.style.width =
    Math.min(Math.max(0, e.clientX - totalVolRect.x), totalVolRect.width) +
    "px";
  volumeVal = Math.min(
    Math.max(0, (e.clientX - totalVolRect.x) / totalVolRect.width),
    1
  );
  video.volume = volumeVal;
}

function handleProgress() {
  if (!video.buffered || !video.buffered.length) {
    return;
  }
  const width = (video.buffered.end(0) / video.duration) * 100 + "%";
  buffer.style.width = width;
}

function toggleFullscreen() {
  if (!document.fullscreenElement) {
    videoContainer.requestFullscreen();
    handleMainStateIcon(`<ion-icon name="scan-outline"></ion-icon>`);
  } else {
    handleMainStateIcon(` <ion-icon name="contract-outline"></ion-icon>`);
    document.exitFullscreen();
  }
}
// Toggle fullscreen mode on double-click
function toggleFullscreenOnDoubleClick() {
  if (isFullscreen()) {
    exitFullscreen();
  } else {
    enterFullscreen();
  }
}

// Check if the video is currently in fullscreen mode
function isFullscreen() {
  return (
    document.fullscreenElement ||
    document.webkitFullscreenElement ||
    document.mozFullScreenElement ||
    document.msFullscreenElement
  );
}

// Enter fullscreen mode
function enterFullscreen() {
  if (videoContainer.requestFullscreen) {
    videoContainer.requestFullscreen();
  } else if (videoContainer.mozRequestFullScreen) {
    videoContainer.mozRequestFullScreen();
  } else if (videoContainer.webkitRequestFullscreen) {
    videoContainer.webkitRequestFullscreen();
  } else if (videoContainer.msRequestFullscreen) {
    videoContainer.msRequestFullscreen();
  }
  videoContainer.classList.add("fullscreen");
}

// Exit fullscreen mode
function exitFullscreen() {
  if (document.exitFullscreen) {
    document.exitFullscreen();
  } else if (document.mozCancelFullScreen) {
    document.mozCancelFullScreen();
  } else if (document.webkitExitFullscreen) {
    document.webkitExitFullscreen();
  } else if (document.msExitFullscreen) {
    document.msExitFullscreen();
  }
  videoContainer.classList.remove("fullscreen");
}

// Event listener for double-click events on the video container
videoContainer.addEventListener("dblclick", toggleFullscreenOnDoubleClick);

function handleMousemove(e) {
  if (mouseDownProgress) {
    e.preventDefault();
    navigate(e);
  }
  if (mouseDownVol) {
    handleVolume(e);
  }
  if (mouseOverDuration) {
    const rect = duration.getBoundingClientRect();
    const width = Math.min(Math.max(0, e.clientX - rect.x), rect.width);
    const percent = (width / rect.width) * 100;
    hoverTime.style.width = width + "px";
    hoverDuration.innerHTML = showDuration((video.duration / 100) * percent);
  }
}

function handleForward() {
  forwardSate.classList.add("show-state");
  forwardSate.classList.add("animate-state");
  video.currentTime += 5;
  handleProgressBar();
}

function handleBackward() {
  backwardSate.classList.add("show-state");
  backwardSate.classList.add("animate-state");
  video.currentTime -= 5;
  handleProgressBar();
}

function handleMainStateIcon(icon) {
  mainState.classList.add("animate-state");
  mainState.innerHTML = icon;
}

function handleMainSateAnimationEnd() {
  mainState.classList.remove("animate-state");
  if (!isPlaying) {
    mainState.innerHTML = `<ion-icon name="play-outline"></ion-icon>`;
  }
  if (document.pictureInPictureElement) {
    mainState.innerHTML = ` <ion-icon name="tv-outline"></ion-icon>`;
  }
}

function toggleTheater() {
  videoContainer.classList.toggle("theater");
  if (videoContainer.classList.contains("theater")) {
    handleMainStateIcon(
      `<ion-icon name="tablet-landscape-outline"></ion-icon>`
    );
  } else {
    handleMainStateIcon(`<ion-icon name="tv-outline"></ion-icon>`);
  }
}

function toggleMiniPlayer() {
  if (document.pictureInPictureElement) {
    document.exitPictureInPicture();
    handleMainStateIcon(`<ion-icon name="magnet-outline"></ion-icon>`);
  } else {
    video.requestPictureInPicture();
    handleMainStateIcon(`<ion-icon name="albums-outline"></ion-icon>`);
  }
}

function handleSettingMenu() {
  settingMenu.classList.toggle("show-setting-menu");
}

function handlePlaybackRate(e) {
  video.playbackRate = parseFloat(e.target.dataset.value);
  speedButtons.forEach((btn) => {
    btn.classList.remove("speed-active");
  });
  e.target.classList.add("speed-active");
  settingMenu.classList.remove("show-setting-menu");
}

function handlePlaybackRateKey(type = "") {
  if (type === "increase" && video.playbackRate < 2) {
    video.playbackRate += 0.25;
  } else if (video.playbackRate > 0.25 && type !== "increase") {
    video.playbackRate -= 0.25;
  }
  handleMainStateIcon(
    `<span style="font-size: 1.4rem">${video.playbackRate}x</span>`
  );
  speedButtons.forEach((btn) => {
    btn.classList.remove("speed-active");
    if (btn.dataset.value == video.playbackRate) {
      btn.classList.add("speed-active");
    }
  });
}

function handleShorthand(e) {
  const tagName = document.activeElement.tagName.toLowerCase();
  if (tagName === "input") return;
  if (e.key.match(/[0-9]/gi)) {
    video.currentTime = (video.duration / 100) * (parseInt(e.key) * 10);
    currentTime.style.width = parseInt(e.key) * 10 + "%";
  }
  switch (e.key.toLowerCase()) {
    case " ":
      if (tagName === "button") return;
      if (isPlaying) {
        video.pause();
      } else {
        video.play();
      }
      break;
    case "f":
      toggleFullscreen();
      break;
    case "arrowright":
      handleForward();
      break;
    case "arrowleft":
      handleBackward();
      break;
    case "t":
      toggleTheater();
      break;
    case "i":
      toggleMiniPlayer();
      break;
    case "m":
      toggleMuteUnmute();
      break;
    case "+":
      handlePlaybackRateKey("increase");
      break;
    case "-":
      handlePlaybackRateKey();
      break;

    default:
      break;
  }
}
document.addEventListener("keydown", (e) => {
  if (e.code === "Space") {
    e.preventDefault(); // Prevent default spacebar behavior (e.g., scrolling)
    showControls();
  }
});
 // Toggle fullscreen mode on F key press
 document.addEventListener("keydown", (e) => {
        if (e.key === "f" || e.key === "F") {
          toggleFullScreen();
        }
      });
      document.addEventListener("keydown", (e) => {
        if (e.code === "Space") {
          e.preventDefault(); // Prevent default spacebar behavior (e.g., scrolling)
          playPauseVideo();
        }
      });

      document.addEventListener("keydown", (e) => {
  if (e.code === "ArrowRight") {
    VideoForward();
  } else if (e.code === "ArrowLeft") {
    VideoBackward();
  }
});

video.addEventListener("dblclick", () => {
        toggleFullScreen();
      });

      video.addEventListener("contextmenu", (e) => {
  e.preventDefault();
});
// Event listener for keydown events
document.addEventListener("keydown", (e) => {
  if (e.code === "ArrowUp") {
    // Increase volume
    increaseVolume();
  } else if (e.code === "ArrowDown") {
    // Decrease volume
    decreaseVolume();
  }
});

// Function to increase volume
function increaseVolume() {
  if (video.volume < 1) {
    video.volume += 0.1;
    volumeVal = video.volume;
    currentVol.style.width = `${volumeVal * 100}%`;
  }
}

// Function to decrease volume
function decreaseVolume() {
  if (video.volume > 0) {
    video.volume -= 0.1;
    volumeVal = video.volume;
    currentVol.style.width = `${volumeVal * 100}%`;
  }
}
// Event listener for clicking on the video element
video.addEventListener("click", togglePlay);

// Function to toggle play/pause of the video
function togglePlay() {
  if (video.paused) {
    play();
  } else {
    pause();
  }
 
}

function exitFullScreen() {
  if (document.exitFullscreen) {
    document.exitFullscreen();
  } else if (document.mozCancelFullScreen) {
    document.mozCancelFullScreen();
  } else if (document.webkitExitFullscreen) {
    document.webkitExitFullscreen();
  } else if (document.msExitFullscreen) {
    document.msExitFullscreen();
  }
}
backBtn.addEventListener("click", toggleFullscreen);

function toggleFullScreen() {
  videoContainer.classList.toggle("fullscreen");
  if (videoContainer.classList.contains("fullscreen")) {
    handleMainStateIcon(`<ion-icon name="tablet-landscape-outline"></ion-icon>`);
  } else {
    handleMainStateIcon(`<ion-icon name="tv-outline"></ion-icon>`);
  }
}

function handleOptionSelection(e) {
  const option = e.target.dataset.option;
  const value = e.target.dataset.value;
  if (option === "audio") {
    // Handle audio selection
    console.log(`Audio selected: ${value}`);
  } else if (option === "subtitles") {
    // Handle subtitles selection
    console.log(`Subtitles selected: ${value}`);
  }
  dropdownContent.classList.remove("show");
}
document.addEventListener("DOMContentLoaded", () => {
  const video = document.getElementById("video");
  const videoUrl = "{{ video_url }}"; // Replace with your video URL

  if (Hls.isSupported()) {
      var hls = new Hls();
      hls.loadSource(videoUrl);
      hls.attachMedia(video);
  } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
      video.src = videoUrl;
  }

  const playPause = document.querySelector(".play-pause");
  const currentTime = document.querySelector(".current-time");
  const totalDuration = document.querySelector(".total-duration");

  let isPlaying = false;

  // Load the last watched time when the page loads
  const lastWatchedTime = localStorage.getItem("lastWatchedTime");
  if (lastWatchedTime !== null) {
      video.currentTime = parseFloat(lastWatchedTime);
  }

  // Add event listeners for video controls
  video.addEventListener("play", () => {
      isPlaying = true;
  });

  video.addEventListener("pause", () => {
      isPlaying = false;
      saveLastWatchedTime();
  });

  // video.addEventListener("timeupdate", () => {
  //     currentTime.innerHTML = formatTime(video.currentTime);
  // });

  video.addEventListener("loadedmetadata", () => {
      totalDuration.innerHTML = formatTime(video.duration);
  });

  playPause.addEventListener("click", () => {
      if (isPlaying) {
          video.pause();
      } else {
          video.play();
      }
  });

  function saveLastWatchedTime() {
      localStorage.setItem("lastWatchedTime", video.currentTime);
  }

  function formatTime(time) {
      const minutes = Math.floor(time / 60);
      const seconds = Math.floor(time % 60);
      return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
  }
});

audioBtn.addEventListener("click", toggleAudioDropdown);

function toggleAudioDropdown() {
  dropdownContent.classList.toggle("show");
}

// Close the dropdown if the user clicks outside of it
document.addEventListener("click", (event) => {
  if (!event.target.closest(".audio")) {
    dropdownContent.classList.remove("show");
  }
});
dropdownOptions.forEach((option) => {
  option.addEventListener("click", handleOptionSelection);
});

function handleOptionSelection(e) {
  const option = e.target.dataset.option;
  const value = e.target.dataset.value;
  if (option === "audio") {
    // Handle audio selection
    console.log(`Audio selected: ${value}`);
    // You can add your logic here to switch the audio track
  } else if (option === "subtitles") {
    // Handle subtitles selection
    console.log(`Subtitles selected: ${value}`);
    // You can add your logic here to switch the subtitles track
  }
  dropdownContent.classList.remove("show");
  e.stopPropagation(); // Prevent the event from propagating to the document click event
}

// Add an event listener to the document for clicks
document.addEventListener("click", (event) => {
  const clickedElement = event.target;
  
  // Check if the clicked element is part of the audio button or dropdown
  if (!clickedElement.closest(".audio")) {
    dropdownContent.classList.remove("show");
  }
});




    </script>
  </body>
</html>